% find error of estimated values
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
[q_diff,w_diff,b_diff,g_diff,s1_diff]=err(dts,tf,q,qe,w,we,b,be,ge,s1e);

figure(21)
subplot(311)
plot(ts,2*q_diff(1,:), ts,-3*2*sqrt(P_cov(1,:)), ts,3*2*sqrt(P_cov(1,:)))
axis([0 tf/3600 -5e-3 5e-3])
title('Quaternion Error with 3 sigma bound')
ylabel('Roll, deg')
subplot(312)
plot(ts,2*q_diff(2,:), ts,-3*2*sqrt(P_cov(2,:)), ts,3*2*sqrt(P_cov(2,:)))
axis([0 tf/3600 -5e-3 5e-3])
ylabel('Pitch, deg')
subplot(313)
plot(ts,2*q_diff(3,:), ts,-3*2*sqrt(P_cov(3,:)), ts,3*2*sqrt(P_cov(3,:)))
axis([0 tf/3600 -5e-3 5e-3])
ylabel('Yaw, deg')
xlabel('Time, hr')

figure(22)
subplot(311)
plot(ts,w_diff(1,:))
title('Rotational Rate Error')
ylabel('Gyro 1, rad/s')
subplot(312)
plot(ts,w_diff(2,:))
ylabel('Gyro 2, rad/s')
subplot(313)
plot(ts,w_diff(3,:))
ylabel('Gyro 3, rad/s')
xlabel('Time, hr')

figure(23)
subplot(311)
plot(ts,b_diff(1,:), ts,-3*sqrt(P_cov(4,:)), ts,3*sqrt(P_cov(4,:)))
title('Gyro Bias Error with 3 sigma bound')
ylabel('Gyro 1, rad/s')
subplot(312)
plot(ts,b_diff(2,:), ts,-3*sqrt(P_cov(5,:)), ts,3*sqrt(P_cov(5,:)))
ylabel('Gyro 2, rad/s')
subplot(313)
plot(ts,b_diff(3,:), ts,-3*sqrt(P_cov(6,:)), ts,3*sqrt(P_cov(6,:)))
ylabel('Gyro 3, rad/s')
xlabel('Time, hr')

figure(24)
subplot(311)
plot(ts,g_diff(1,:)*1e6, ts,-3*sqrt(P_cov(7,:))*1e6, ts,3*sqrt(P_cov(7,:))*1e6)
axis([0 tf/3600 -300 300])
title('Gyro Scale Factor Error with 3 sigma bound')
ylabel('\lambda_{x}, ppm')
subplot(312)
plot(ts,g_diff(5,:)*1e6, ts,-3*sqrt(P_cov(11,:))*1e6, ts,3*sqrt(P_cov(11,:))*1e6)
axis([0 tf/3600 -300 300])
ylabel('\lambda_{y}, ppm')
subplot(313)
plot(ts,g_diff(9,:)*1e6, ts,-3*sqrt(P_cov(15,:))*1e6, ts,3*sqrt(P_cov(15,:))*1e6)
axis([0 tf/3600 -300 300])
ylabel('\lambda_{z}, ppm')
xlabel('Time, hr')

figure(25)
subplot(321)
plot(ts,g_diff(2,:)*206264.8, ts,-3*sqrt(P_cov(8,:))*206264.8, ts,3*sqrt(P_cov(8,:))*206264.8)
axis([0 tf/3600 -300 300])
ylabel('\delta_{yz}, arc-s')
title('Gyro Misalignment Error with 1 sigma bound')
subplot(322)
plot(ts,g_diff(3,:)*206264.8, ts,-3*sqrt(P_cov(9,:))*206264.8, ts,3*sqrt(P_cov(9,:))*206264.8)
axis([0 tf/3600 -300 300])
ylabel('\delta_{zy}, arc-s')
subplot(323)
plot(ts,g_diff(4,:)*206264.8, ts,-3*sqrt(P_cov(10,:))*206264.8, ts,3*sqrt(P_cov(10,:))*206264.8)
axis([0 tf/3600 -300 300])
ylabel('\delta_{xz}, arc-s')
subplot(324)
plot(ts,g_diff(2,:)*206264.8, ts,-3*sqrt(P_cov(12,:))*206264.8, ts,3*sqrt(P_cov(12,:))*206264.8)
axis([0 tf/3600 -300 300])
ylabel('\delta_{zx}, arc-s')
subplot(325)
plot(ts,g_diff(2,:)*206264.8, ts,-3*sqrt(P_cov(13,:))*206264.8, ts,3*sqrt(P_cov(13,:))*206264.8)
axis([0 tf/3600 -300 300])
ylabel('\delta_{xy}, arc-s')
subplot(326)
plot(ts,g_diff(2,:)*206264.8, ts,-3*sqrt(P_cov(14,:))*206264.8, ts,3*sqrt(P_cov(14,:))*206264.8)
axis([0 tf/3600 -300 300])
ylabel('\delta_{yx}, arc-s')
xlabel('Time, hr')

figure(26)
subplot(311)
plot(ts,s1_diff(1,:)*60^2, ts,-3*sqrt(P_cov(16,:))*60^2, ts,3*sqrt(P_cov(16,:))*60^2)
axis([0 tf/3600 -20 20])
title('Star Tracker 3 Misalignment Error with 3 sigma bound')
ylabel('x, arc-s')
subplot(312)
plot(ts,s1_diff(2,:)*60^2, ts,-3*sqrt(P_cov(17,:))*60^2, ts,3*sqrt(P_cov(17,:))*60^2)
axis([0 tf/3600 -20 20])
ylabel('y, arc-s')
subplot(313)
plot(ts,s1_diff(3,:)*60^2, ts,-3*sqrt(P_cov(18,:))*60^2, ts,3*sqrt(P_cov(18,:))*60^2)
axis([0 tf/3600 -20 20])
ylabel('z, arc-s')
xlabel('Time, hr')

